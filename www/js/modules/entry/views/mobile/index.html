<ion-view view-title="MemryBook">
  <ion-nav-title>
    <div class="bar bar-header item-input-inset">
      <label class="item-input-wrapper">
        <i class="icon ion-ios-search placeholder-icon"></i>
        <input type="search" placeholder="Search">
      </label>
      <button class="button button-clear">
        Cancel
      </button>
    </div>
  </ion-nav-title>

  <ion-content ng-controller="EntriesCtrl as entry">

    <div class="list card" ng-repeat="entry in entries">
      <div class="item item-text-wrap gray">
        <i class="button-icon icon ion-android-more-horizontal" style="float:right;" ng-click="openPopover($event,entry)"></i>
        <h2>{{entry.title}}</h2>
        <p>{{entry.date | date: "longDate"}}</p>
      </div>

      <section  ng-controller="PanelCtrl as panel">
        <div class="item tabs tabs-secondary tabs-icon-left">
          <a class="tab-item" href="#" ng-click="panel.selectTab(1)" ng-class="{ active:panel.isSelected(1) }">
            <i class="icon ion-ios-glasses"></i>
            Visual
          </a>
          <a class="tab-item" href="#" ng-click="panel.selectTab(2)" ng-class="{ active:panel.isSelected(2) }">
            <i class="icon ion-mic-c"></i>
            Audio
          </a>
          <a class="tab-item" href="#" ng-click="panel.selectTab(3)" ng-class="{ active: panel.isSelected(3) }">
            <i class="icon ion-document-text"></i>
            Files
          </a>
        </div>


        <!-- Video/Images content -->
        <div class="item item-body panel" ng-show="panel.isSelected(1)">
          <p read-more ng-if="entry.content" ng-model="entry.content" words="true" length="50"></p>

          <ion-slide-box does-continue="true" >
            <ion-slide ng-repeat="resource in entry.resources" ng-if="resource.attachment_content_type == 'image' || resource.attachment_content_type == 'video'">
              <img ng-src="{{resource.attachment}}" ng-click='showModal($index,entry.resources)' class="full-image" ng-if="resource.attachment_content_type == 'image'">
              <div ng-if="resource.attachment_content_type == 'video'" class="video-thumb" ng-click='showModal($index,entry.resources)'>
                <img ng-src="{{resource.attachment_thumbnail}}" class="video full-image">
                <i class="icon ion-play"></i>
              </div>
            </ion-slide>
          </ion-slide-box>
          <p class="labels" ng-if="entry.tags.length">
            Labels: <a href="#" class="subdued" ng-repeat="tag in entry.tags">{{tag.name}}{{$last ? '' : ', '}}</a>
          </p>
        </div>

        <!-- Audio content -->
          <ion-audio-track track="track" ng-show="panel.isSelected(2)">
            <div class="list">
            <ion-audio-progress-bar display-time></ion-audio-progress-bar>
              <div class="item item-thumbnail-left" ng-repeat="resource in entry.resources" ng-if="resource.attachment_content_type == 'audio'">
                <img src="http://komatsushima.main.jp/wp-content/uploads/2013/12/podcast.png">
                <ion-audio-controls>
                  <a class="button button-icon icon" ng-click='play(resource.attachment)' ion-audio-play></a>
                  <ion-spinner icon="ios"></ion-spinner>
                </ion-audio-controls>
                <h4>{{resource.attachment_file_name}}</h4>
              </div>
            </div>
            <p class="item-body">
              Labels: <a href="#" class="subdued" ng-repeat="tag in entry.tags">{{tag.name}}{{$last ? '' : ','}}</a>
            </p>
          </ion-audio-track>

        <!-- Files content -->
        <div class="item item-body panel" ng-show="panel.isSelected(3)">
          <p ng-repeat="resource in entry.resources"  ng-if="resource.attachment_content_type == 'pdf'">
            <i class="icon ion-document-text"></i>
            <a href="{{resource.attachment}}">{{resource.attachment_file_name}}</a>
          </p>
          <p class="labels" ng-if="entry.tags.length">
            Labels: <a href="#" class="subdued" ng-repeat="tag in entry.tags">{{tag.name}}{{$last ? '' : ', '}}</a>
          </p>
        </div>
      </section>

      <!-- Share Entry -->
      <div class="item tabs tabs-secondary tabs-icon-left gray">
        <a class="tab-item" href="#" ng-click="shareModal.show()">
          <i class="icon ion-share"></i>
          Share
        </a>
      </div>
    </div>
  </ion-content>
</ion-view>

<!-- Popover for editing and deleting-->
<script id="my-popover.html" type="text/ng-template">
  <ion-popover-view>
    <ion-content>
      <div class="list">
        <a class="item" ng-click="openEdit()" ng-model="entry.id">
          Edit
        </a>
        <a class="item" ng-click="remove()">
          Delete
        </a>
      </div>
    </ion-content>
  </ion-popover-view>
</script>
